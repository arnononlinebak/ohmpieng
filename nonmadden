
server {
  server_name blog.nonmadden.com nonmadden.com www.nonmadden.com;
  rewrite ^ https://get.nonmadden.com/blog/ redirect;
}

server {
  listen 443 ssl;
  server_name get.nonmadden.com;
  index index.html index.php;
  include php-fpm;
  access_log  /home/non/logs/nonmadden.access.log  combined;
  ssl_certificate  /etc/nginx/ssl/nonmadden.crt;
  ssl_certificate_key  /etc/nginx/ssl/nonmadden.key;

  location / {
    root  /home/non/marketing/;
    try_files $uri $uri/ /index.php;
  }

  location /blog {
    root  /home/non/blog/;
    try_files $uri $uri/ blog/index.php?$args;
  }

  location = /favicon.ico {
    log_not_found off;
    access_log off;
  }

  location = /robots.txt {
    allow all;
    log_not_found off;
    access_log off;
  }

  location ~* \.(ico|css|js|gif|jpe?g|png)(\?[0-9]+)?$ {
    expires max;
    log_not_found off;
  }
}



server {
  listen 443 ssl;
  server_name status.nonmadden.com;
  root /home/non/www/server/;
  index index.html index.php;
  include php-fpm;
  autoindex on;
  access_log /home/non/logs/nonmadden-status.log combined;

  location / {
    auth_basic "Administrator Login";
    auth_basic_user_file /home/non/www/server/.htpasswd;
  }
}

server {
  listen  80;
  listen 443 ssl;
  server_name cloud.nonmadden.com;
  root  /home/non/www/cloud/;
  index index.html index.php;
  include php-fpm;
  autoindex on;
  access_log /home/non/logs/nonmadden-cloud.log combined;
}

server {
  listen 80;
  server_name applications.nonmadden.com;
  passenger_enabled on;
  rails_env production;
  root /home/production/current/public;

  access_log /home/non/logs/nonmadden-apps.log combined;

  location / {
    access_log off;
    expires 0;
    add_header Cache-Control private;
  }
}

server {
  listen  80;
  server_name developers.nonmadden.com;
  root  /home/non/www/developers/;
  index index.html index.php;
  include php-fpm;
  access_log /home/non/logs/nonmadden-developers.log combined;
}

server {
  listen  80;
  listen 443 ssl;
  server_name live.nonmadden.com;
  root  /home/non/www/live/;
  index index.html index.php;
  include php-fpm;
  access_log /home/non/logs/nonmadden-live.log combined;
}
